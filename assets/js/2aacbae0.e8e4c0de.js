"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[82999],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>f});var r=o(67294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)o=l[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)o=l[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var s=r.createContext({}),c=function(e){var t=r.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=c(o),d=n,f=m["".concat(s,".").concat(d)]||m[d]||u[d]||l;return o?r.createElement(f,a(a({ref:t},p),{},{components:o})):r.createElement(f,a({ref:t},p))}));function f(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=o.length,a=new Array(l);a[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[m]="string"==typeof e?e:n,a[1]=i;for(var c=2;c<l;c++)a[c]=o[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,o)}d.displayName="MDXCreateElement"},93816:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var r=o(87462),n=(o(67294),o(3905));const l={id:"zio-temporal",title:"ZIO Temporal"},a=void 0,i={unversionedId:"ecosystem/community/zio-temporal",id:"ecosystem/community/zio-temporal",title:"ZIO Temporal",description:"ZIO Temporal is a ZIO library for Temporal, a microservice workflow orchestration platform.",source:"@site/docs/ecosystem/community/zio-temporal.md",sourceDirName:"ecosystem/community",slug:"/ecosystem/community/zio-temporal",permalink:"/ecosystem/community/zio-temporal",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/ecosystem/community/zio-temporal.md",tags:[],version:"current",frontMatter:{id:"zio-temporal",title:"ZIO Temporal"},sidebar:"ecosystem-sidebar",previous:{title:"ZIO Slick Interop",permalink:"/ecosystem/community/zio-slick-interop"},next:{title:"ZIO Test Akka HTTP",permalink:"/ecosystem/community/zio-test-akka-http"}},s={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Installation",id:"installation",level:2},{value:"Example",id:"example",level:2}],p={toc:c},m="wrapper";function u(e){let{components:t,...o}=e;return(0,n.kt)(m,(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://zio-temporal.vhonta.dev/"},"ZIO Temporal")," is a ZIO library for Temporal, a microservice workflow orchestration platform."),(0,n.kt)("h2",{id:"introduction"},"Introduction"),(0,n.kt)("p",null,"ZIO Temporal is a ZIO library based on the Temporal Java-SDK. ZIO Temporal brings first-class Scala & ZIO support with additional compile-time checks that Java SDK lacks."),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://temporal.io/"},"Temporal")," platform helps to eliminate complex error or retry logic, avoid callbacks, and ensure that every workflow you start, completes. Temporal delivers durable execution for your services and applications."),(0,n.kt)("h2",{id:"installation"},"Installation"),(0,n.kt)("p",null,"In order to use this library, we need to add the following dependency:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies += "dev.vhonta" %% "zio-temporal-core" % "0.2.0-M3"\n')),(0,n.kt)("h2",{id:"example"},"Example"),(0,n.kt)("p",null,'Here we have one ZIO app with two "modules", one which is the worker that executes the workflow activity and the other is the Client which sends the request to the Temporal platform. To run the sample, it\'s required to download ',(0,n.kt)("a",{parentName:"p",href:"https://github.com/temporalio/cli"},"Temporal cli")," (recommended for development)."),(0,n.kt)("p",null,"Run the Temporal server on one shell:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},"temporal server start-dev --ip 0.0.0.0 --db-filename /tmp/temporal.db\n")),(0,n.kt)("p",null,"Now we can run the sample application which is based on Temporal Java SDK docs using ",(0,n.kt)("a",{parentName:"p",href:"https://scala-cli.virtuslab.org"},"scala-cli"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-scala"},'//> using scala "3.3.0-RC3" // We use Scala 3.3 to leverage SIP-44 (FewerBraces)\n\n//> using lib "dev.zio::zio:2.0.13"\n//> using lib "dev.vhonta::zio-temporal-core:0.2.0-M3"\n//> using lib "dev.zio::zio-logging:2.1.12"\n//> using lib "dev.zio::zio-logging-slf4j2-bridge:2.1.12"\n//> using option "-source:future", "-Wunused:imports", "-Wvalue-discard"\n\nimport zio.*\nimport zio.temporal.*\nimport zio.temporal.worker.*\nimport zio.temporal.workflow.*\nimport zio.logging.*\n\n// This is our workflow interface\n@workflowInterface\ntrait EchoWorkflow:\n\n  @workflowMethod\n  def echo(str: String): String\n\n// Workflow implementation\nclass EchoWorkflowImpl extends EchoWorkflow:\n  override def echo(str: String): String =\n    ZIO.logInfo(s"Worker: Received \\"$str\\"")\n    s"ACK: $str"\n\n// Main Application\nobject Main extends ZIOAppDefault:\n  val taskQueue = "echo-queue"\n\n  // Worker implementation\n  val worker = ZWorkerFactory.newWorker(taskQueue) @@\n    ZWorker.addWorkflow[EchoWorkflowImpl].fromClass\n\n  // Client implementation\n  def invokeWorkflow(msg: String) = ZIO.serviceWithZIO[ZWorkflowClient]: client =>\n    for\n      uuid <- Random.nextUUID\n      workflowID = s"echo-$uuid"\n      echoWorkflow <- client\n                        .newWorkflowStub[EchoWorkflow]\n                        .withTaskQueue(taskQueue)\n                        .withWorkflowId(workflowID)\n                        .withWorkflowRunTimeout(2.seconds)\n                        .withRetryOptions(ZRetryOptions.default.withMaximumAttempts(3))\n                        .build\n      _   <- ZIO.logInfo(s"Will submit message \\"$msg\\" with workflow ID $workflowID")\n      res <- ZWorkflowStub.execute(echoWorkflow.echo(msg))\n      _   <- ZIO.logInfo(s"Greeting received: $res")\n    yield res\n\n  // Logging configuration\n  val logFilter: LogFilter[String] = LogFilter.logLevelByName(\n    LogLevel.Debug,\n    "io.grpc.netty" -> LogLevel.Warning,\n    "io.netty"      -> LogLevel.Warning,\n    "io.temporal"   -> LogLevel.Error,\n  )\n  override val bootstrap: ZLayer[ZIOAppArgs, Any, Any] =\n    Runtime.removeDefaultLoggers >>> consoleLogger(ConsoleLoggerConfig(LogFormat.colored, logFilter))\n\n  // ZIO Main Program\n  def run: ZIO[ZIOAppArgs & Scope, Any, Any] =\n    val program =\n      for\n        args           <- getArgs\n        msg             = if args.isEmpty then "testMsg" else args.mkString(" ")\n        _              <- worker\n        _              <- ZWorkerFactory.setup\n        _              <- ZWorkflowServiceStubs.setup()\n        workflowResult <- invokeWorkflow(msg)\n        _              <- ZIO.logInfo(s"The workflow result: $workflowResult")\n      yield ExitCode.success\n\n    program\n      .provideSome[ZIOAppArgs & Scope](\n        ZLayer.succeed(ZWorkflowServiceStubsOptions.default),\n        ZLayer.succeed(ZWorkflowClientOptions.default),\n        ZLayer.succeed(ZWorkerFactoryOptions.default),\n        ZWorkflowClient.make,\n        ZWorkflowServiceStubs.make,\n        ZWorkerFactory.make,\n        slf4j.bridge.Slf4jBridge.initialize,\n      )\n')),(0,n.kt)("p",null,"Generates the output:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},'\u276f scli zio-temporal.scala\nCompiling project (Scala 3.3.0-RC3, JVM)\nCompiled project (Scala 3.3.0-RC3, JVM)\ntimestamp=2023-04-18T17:33:59.970297-03:00 level=INFO thread=zio-fiber-4 message="ZWorkerFactory started"\ntimestamp=2023-04-18T17:34:00.010519-03:00 level=INFO thread=zio-fiber-4 message="Will submit message "testMsg" with workflow ID echo-81ef73da-d54d-492a-8f91-78e888dcebc8"\ntimestamp=2023-04-18T17:34:00.27055-03:00  level=INFO thread=zio-fiber-4 message="Greeting received: ACK: testMsg"\ntimestamp=2023-04-18T17:34:00.271691-03:00 level=INFO thread=zio-fiber-4 message="The workflow result: ACK: testMsg"\ntimestamp=2023-04-18T17:34:00.325834-03:00 level=INFO thread=zio-fiber-4 message="ZWorkerFactory shutdownNow initiated..."\n')),(0,n.kt)("p",null,"Results of the execution can also be seen in the ",(0,n.kt)("a",{parentName:"p",href:"http://localhost:8233"},"Temporal UI")," running locally or the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/temporalio/tctl"},"tctl")," tool:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},'\u276f tctl workflow observe --workflow_id echo-81ef73da-d54d-492a-8f91-78e888dcebc8\nProgress:\n  1, 2023-04-18T20:34:00Z, WorkflowExecutionStarted\n  2, 2023-04-18T20:34:00Z, WorkflowTaskScheduled\n  3, 2023-04-18T20:34:00Z, WorkflowTaskStarted\n  4, 2023-04-18T20:34:00Z, WorkflowTaskCompleted\n  5, 2023-04-18T20:34:00Z, WorkflowExecutionCompleted\n\nResult:\n  Run Time: 1 seconds\n  Status: COMPLETED\n  Output: ["ACK: testMsg"]\n')))}u.isMDXComponent=!0}}]);